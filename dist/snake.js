"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function e(t,i){for(var o=0;o<i.length;o++){var e=i[o];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(t,i,o){return i&&e(t.prototype,i),o&&e(t,o),t}}();function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var DIRECTION={UP:"up",RIGHT:"right",DOWN:"down",LEFT:"left"},SnakeGame=function(){function o(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,o),t.container&&"object"!==_typeof(t.container))throw new Error("Missing game container");var i={canvas:document.querySelector("#bwSnake"),width:400,height:400,box:20,speed:100,color:{bg:"#000",snake:"#fff",snakeHead:"silver",infoBg:"#fff",infoText:"red",scoreText:"#000",pointBox:"red"},font:{info:"15px Oswald",score:"30px Oswald",restart:"15px Oswald"},text:{gameOver:"GAMEOVER",winner:"MAXPOINTS!",restart:"RESTART"}};this.options=Object.assign({},i,t),this.init()}return _createClass(o,[{key:"init",value:function(){this.resetVars(),this.attachEvents(),this.start()}},{key:"resetVars",value:function(){this.score=0,this.scoreLimit=this.options.width*this.options.height/this.options.box,this.snake=[{x:8*this.options.box,y:8*this.options.box},{x:8*this.options.box,y:7*this.options.box},{x:8*this.options.box,y:6*this.options.box}],this.pointBox={x:null,y:null},this.ctx=null,this.game=null,this.direction=DIRECTION.DOWN,this.restartVisible=!1,this.directionLock=!1}},{key:"attachEvents",value:function(){document.addEventListener("keydown",this.control.bind(this)),document.addEventListener("click",this.clickHandler.bind(this))}},{key:"start",value:function(){this.resetVars(),this.game=setInterval(this.draw.bind(this),this.options.speed)}},{key:"control",value:function(t){var i=t.keyCode,o=this.direction;this.directionLock||(37===i&&o!==DIRECTION.RIGHT?this.direction=DIRECTION.LEFT:39===i&&o!==DIRECTION.LEFT?this.direction=DIRECTION.RIGHT:38===i&&o!==DIRECTION.DOWN?this.direction=DIRECTION.UP:40===i&&o!==DIRECTION.UP&&(this.direction=DIRECTION.DOWN),this.directionLock=!0)}},{key:"clickHandler",value:function(t){var i=t.offsetX,o=t.offsetY;this.restartVisible&&175<i&&i<225&&220<o&&o<235&&(this.score=0,this.start())}},{key:"draw",value:function(){this.directionLock=!1,this.drawLevel(),this.drawSnake(),this.drawPointBox(),this.collision()}},{key:"drawLevel",value:function(){var t=this.options,i=t.width,o=t.height,e=t.color.bg;this.options.canvas.setAttribute("width",i),this.options.canvas.setAttribute("height",o),this.ctx=this.options.canvas.getContext("2d"),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,i,o)}},{key:"drawSnake",value:function(){var t=this.options,i=t.box,o=t.color,e=o.snake,s=o.snakeHead;this.move();for(var n=0;n<this.snake.length;n++)this.ctx.fillStyle=0===n?e:s,this.ctx.fillRect(this.snake[n].x,this.snake[n].y,i,i)}},{key:"drawPointBox",value:function(){var i=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],o=this.options,e=o.width,s=o.height,n=o.box,r=o.color.pointBox,a=void 0,h=void 0;t?(a=Math.floor(Math.random()*e/n)*n,h=Math.floor(Math.random()*s/n)*n):(a=0===this.pointBox.x||this.pointBox.x?this.pointBox.x:Math.floor(Math.random()*e/n)*n,h=0===this.pointBox.y||this.pointBox.y?this.pointBox.y:Math.floor(Math.random()*s/n)*n),this.snake.forEach(function(t){return t.x===a&&t.y===h&&i.drawPointBox(!0),!1}),this.pointBox={x:a,y:h},this.ctx.fillStyle=r,this.ctx.fillRect(a,h,n,n)}},{key:"drawInfo",value:function(){var t=this.options,i=t.color,o=i.infoBg,e=i.infoText,s=i.scoreText,n=t.font,r=t.text,a=r.gameOver,h=r.winner,c=r.restart;this.ctx.fillStyle=o,this.ctx.fillRect(100,150,200,100),this.ctx.font=n.info,this.ctx.fillStyle=e,this.ctx.textAlign="center";var l=this.score!==this.scoreLimit?a:h;this.ctx.fillText(l,200,175),this.ctx.font=n.score,this.ctx.fillStyle=s,this.ctx.fillText(this.score,200,210),this.ctx.font=n.restart,this.ctx.fillText(c,200,235),this.restartVisible=!0}},{key:"collision",value:function(){var s=this.snake,t=this.options,i=t.width,o=t.height,e=t.box,n=s.find(function(t,i){var o=t.x,e=t.y;return 0!==i&&o===s[0].x&&e===s[0].y});(s[0].x>i-e||s[0].x<0||s[0].y>o-e||s[0].y<0||n)&&this.stop()}},{key:"move",value:function(){var t=this.direction,i=this.options.box,o=this.pointBox,e=this.snake[0].x,s=this.snake[0].y,n=e,r=s;switch(t){case DIRECTION.LEFT:n=e-i;break;case DIRECTION.RIGHT:n=e+i;break;case DIRECTION.UP:r=s-i;break;case DIRECTION.DOWN:r=s+i}this.snake.unshift({x:n,y:r}),n===o.x&&r===o.y?(this.drawPointBox(!0),this.score=this.score+1):this.snake.pop()}},{key:"stop",value:function(){clearInterval(this.game),this.drawInfo()}}]),o}();